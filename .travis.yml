language: node_js
node_js:
- "10"

env:
  global:
  - GIT_AUTHOR_EMAIL=bgpat@users.noreply.github.com
  - GIT_AUTHOR_NAME=bgpat
  - GIT_URL=git@github.com:bgpat/pynycode-converter.git
  # DEPLOY_KEY
  - secure: "XJ/jBiBDpz/KdD6Bg5TCfMUF2kILUBlua+uP7VrH5aFYGRrGdCsqhprcKV+4a5B1ioHzSWZSmb7z4Xrju/VmokVfmwcdm41WvnGbzU8Cn81GxBib3zkbjaNZQFRSvRtISmcjBVu7DVS22zkmaMgKB6YC2woLZ1g8C6wDHhY1hYbY2tf7JSVF6My6zH6Bn/GzcNQMqcBt08keQpaKyUpp0Fzj0Dmmck9saXNGJrgk7ZNBRTmz3Z2cuaY7RLSdumsBQ38h7A97hGHWvd8u5tNxbV21nJt3V55tOUPyMs1Z1qP+HiLeFxb+9qqooTqcEZRlnr1Tl0I9ApCY9ZyLjb/M9iSdfjE5kQnqk8/qC8SvO0g3ECfORgxFK8GiwvVKid6uXiKXLw7S/zD4KQj24ZM1SsLotyYJ1/1mc3TVf91ycfBFhJ529UjaiJ3dYe/2e9cEgPYCPR25LwIuaDF3Yo4yNda/iWc+jzir3sVxi1xJlRf4s9yemU3ixfWm69hGsCIa9E31LO0HxOHUTVHiGDyiZrpkn8RezCGoHYTKYvnzjnk0OTL+txJ+ra8gCXcnf2OlcDjNa48MimGExsKa74vQWpvX87t3R314g1T98uUBeyWnjMKUsWN3/sjVOwpNa5m7rK4/9+V2o6wsVZYa66h7UberPWdpcZf+DAkDvM7Yvbk="

install:
- npm install

before_script:
- rm -rf dist

script:
- npm run build

before_deploy:
- mkdir -p ~/.ssh
- echo $DEPLOY_KEY > ~/.ssh/id_ed25519
- chmod 600 ~/.ssh/id_ed25519
- git remote set-url origin ${GIT_URL}
- git fetch origin gh-pages:remotes/origin/gh-pages
- git worktree add -B gh-pages dist origin/gh-pages
- git checkout gh-pages
- git add dist
- git commit -m 'Update gh-pages'

deploy:
  skip_cleanup: true
  provider: script
  script: git push -f
  on:
    all_branches: true
# on:
#   branch: master
