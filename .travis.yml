language: node_js
node_js:
- "10"

env:
  global:
  - GIT_AUTHOR_EMAIL=bgpat@users.noreply.github.com
  - GIT_AUTHOR_NAME=bgpat
  - GIT_URL=git@github.com:bgpat/pynycode-converter.git
  # DEPLOY_KEY
  - secure: "O3b+035PfGX0tFmsTnMpc7Hy0J03RHYCjvmS722bZGu0Tca677724G8u7VaZAacINYZ0npKB7uOc7IJi29PVpPvVfUOD+W3o3CpZbTwvlPZRxYN4gB5r5Iwj7r6SV5WVRmS6kZEFgJDGjXzIBegZ17Barvf99aQ+mXb1Y8c1kU2JMnAruHJynjVdtILR77sT6NTgLApdli+/SUumlv9MGj4G05TJlh1sLW4hUzCy1htCeoTj24uSR2Oj9a5tAR5jXyU1hHU8aHjC1rQNmEQBvbUdVvWtDI4PedtUIgoab7oNwHDJbyfcwjqYteaJngxi0/zeCJ7hH9yRA7+ZmahW8HUGjL5fTtsZVhJTqrUaS5ia8qoEeWCudPlacu8/IkHRbClxTkRyIhcssD9OeZ4iDPAKbZ13hAl3LZGkwHn/uR6OXOcogJLxClSrpwqQwbtp34pRmmwdtj5cqjScTKnK69kXsx8zyoQ7idSLSxC3M2jhhPd7XuuY+oG5fecKRLnX0Y2M2ub4+sr39dxnJZh/FbWtz6h7ep7h61bNPZkpmAO6xjdUcIWyd27T0ODbuJ+SC96kyLvc/oaS8XGdyOsLy3TdnKCLyufZo692pja5srdx1RAQzA/BTKj8swTwfy5mp81MqZbo+9MvTxX9KkZwnpjB1jHeueNuVRRFzVZV8rk="

install:
- npm install

before_script:
- rm -rf dist

script:
- npm run build

before_deploy:
- mkdir -p ~/.ssh
- echo $DEPLOY_KEY > ~/.ssh/id_ed25519
- chmod 600 ~/.ssh/id_ed25519
- git remote set-url origin ${GIT_URL}
- git fetch origin gh-pages:remotes/origin/gh-pages
- git worktree add -B gh-pages dist origin/gh-pages
- git checkout gh-pages
- git add dist
- git commit -m 'Update gh-pages'

deploy:
  skip_cleanup: true
  provider: script
  script: git push -f
  on:
    all_branches: true
# on:
#   branch: master
