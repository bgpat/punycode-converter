language: node_js
node_js:
- "10"

env:
  global:
  - GIT_AUTHOR_EMAIL=bgpat@users.noreply.github.com
  - GIT_AUTHOR_NAME=bgpat
  - GIT_URL=git@github.com:bgpat/pynycode-converter.git
  # DEPLOY_KEY
  - secure: "XcABv+TBTibd4yH5bMhJ7W6UnMpomuCz0bGD6JcY/Gatc89QN2+ZNMCY9sGtpbDudJypMrRt6ujgOLt/PIxnMQL7n0ModoglMv7hvi5GOLiMBv1SRhNjrd8113lZUIewRBBrvh9gxOyZGVXwKkyWLG4qVPkEWlLbwZXRiQ3MEIbpOhqnTySxEb7R5+TqvwnQ0XZfyu8tFOwOcyWW9KlW21zA6YSBqHmxo3F0pDx0YXfWUkJKOG/mGWl/A5bR04QwTE1ndHRlQI6n+yOpQX6PNJp50OHShH60lgRWpVxF81bc5UkGsJwA9kt1kE22w9br/quVUuF26CHNyZctO6KnbaI4brVfPaWjju2z3nyG6iQHbOEvq0k5RAhnh9L3M47mIrW2SNIH3erhZ2e1hyHjMehEhkJL0ohhg7YyXwRl+/O6iJsJtZtcSPPeOMHA4qAh695yGM+rsVhFNF1CWwaCYeLnF3+wPWU9T/rn9RhvkAzAW8JZkOCgtNUfoOZEMt+y9fNb5Qwn8G66q1dMbwe1JmwFWGhh0dC8g3d3AG0MDe72OHqT6kKPWr+p3483qXYjVsf8w1Er3PvgT+VygSsF15TNWvh4ttHfLILjrBO+IUghyjUZIBU2kvDA7X82WwjXoTcqX5QEV9a6VwM3MpUYXHXV2SQYSOv9EbxFiyqLAmo="

install:
- npm install

before_script:
- rm -rf dist

script:
- npm run build

before_deploy:
- mkdir -p ~/.ssh
- echo $DEPLOY_KEY > ~/.ssh/id_ed25519
- chmod 600 ~/.ssh/id_ed25519
- git remote set-url origin ${GIT_URL}
- git fetch origin gh-pages:remotes/origin/gh-pages
- git worktree add -B gh-pages dist origin/gh-pages
- git checkout gh-pages
- git add dist
- git commit -m 'Update gh-pages'

deploy:
  skip_cleanup: true
  provider: script
  script: git push -f
  on:
    all_branches: true
# on:
#   branch: master
