language: node_js

env:
  global:
  - GIT_AUTHOR_EMAIL=bgpat@users.noreply.github.com
  - GIT_AUTHOR_NAME=bgpat
  - GIT_URL=git@github.com:bgpat/pynycode-converter.git
  # DEPLOY_KEY
  - secure: "jOPa0njZrswHNajQDNVDCiV3Up3o4E29IKbmKPd3mUVto4+8IAmROCZfUNX2znAD5hb956DG3aKzJauYSEZzPiOhS8tVd5syl8OrGinFIAlEDIT72SzPh7Cc7sgN8swUTFWF90CujKUvMRqQSvv8SweeOhEyzucQYBsZGTHIGXGYEPCA1VjkIylsheO36kdzmeRP0aqgG/G96hq5TA6c+79V5ApSpI6Nqfw3tHS6m/E8aB8NH3vG2rARfc8tAQnVBtsF0NnQdk0g6gpVksBeGs9hyxKjUOQ5TbpG6R5OC02i9wOJgNYwuiDCVFT+s/z9CcGvCO7137viDcuuL7M56ivkp2EAauZjLi+YxE3V4tN3bz7/dtx2lPnlCwCVgtABsbHZgF9TLaq8OKf4rM2SVaSXhCGxUMiQfO0T6HDXsWLOTcejCjW24t/g07qxygComIgtw0ETJWgAtQ/Lk6u/haz6t7mraRTV1GGO8TYcYhCUEFRfGrcP5CN5vp8dWE8AZNhwYCOz2G/WN/8+1wrUlHNun34Wtz6Dgh3vqsLUrooVn2s7seHZKV0zxCcd/yA8K3o1M6yKKLpLe8DV7IFxKiWqWg1vbsqa+2EFxwHASL4yMu4N9rIRXs1NKl8YpuO0+VlRw8wfL0GVxcC665aSX+zTuFynU832Wi0KbVYORCA="

install:
- npm install

before_script:
- rm -rf dist

script:
- npm run build

before_deploy:
- mkdir -p ~/.ssh
- echo $DEPLOY_KEY > ~/.ssh/id_ed25519
- git remote set-url origin ${GIT_URL}
- git fetch origin gh-pages:remotes/origin/gh-pages
- git worktree add -B gh-pages dist origin/gh-pages
- git checkout gh-pages
- git add dist
- git commit -m 'Update gh-pages'

deploy:
  skip_cleanup: true
  provider: script
  script: git push -f
# on:
#   branch: master
