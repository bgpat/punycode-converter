language: node_js
node_js:
- "10"

env:
  global:
  - GIT_AUTHOR_EMAIL=bgpat@users.noreply.github.com
  - GIT_AUTHOR_NAME=bgpat
  - GIT_URL=git@github.com:bgpat/pynycode-converter.git
  # DEPLOY_KEY
  - secure: "aZr2fplhfbLSmdM+LPy8GTLPhhEcxOUjZuCTOiiUO9IIYtnajt3xFAFmWWANFQg22GWYIMZs2xawy1wcsqr6p5lm0i6NdCVxF5bRtO8JK9uHgIStIUE9q1SUtYWWRK5igdPmvx8lrXRsEAm+hxas9SyU0vpKoFBHTHo9oaBBmKIHYHNjcsD8oSPuT+SKJfxcrTOmGPTsSXCGI4ystC5IFFl8HAoapc9f2PYrKz7pGM+sz83kmcwcNCSAx6BzegsxGHuZZ/o41FRYFyHN3SZnOcV5J1RW4TfLrr/3pXXE4c74oXLAfKbODxp0vTc8GYH8pmHwBndiKuzUt/WF1/guUS/R7zt8AoNfvSeVmOvuLuOHSXlz5tZA4qoCO7yHmTFJnRXcPfZ1gg9uw6tvsILDeFimYbG2Ycs46jF/1yeIcBfyxpL6Ruq2jj1ngsGMwff3LPF84x3gFCGBlGTnSc0K2+ELCuM+XhUiDu22ewq3SAxmWtjuKCtv4fVNhDfY7LM5bRNJHeTzOpI6SWbn1TVlE5C3P+uFZJ0PdC6+42FXPXmleiGFlkd1YSq/U4WydIc7zBNjZH7I41dzr0ecOYj7Su3xZxCcLeN4iORg3KaF1TrhszCM2M5bWpyovBIOnFR7N0KdZ+gnHj4+KoCmVDo0gMWy8BTa+5dskA8nhUsiCe4="
install:
- npm install

before_script:
- rm -rf dist

script:
- npm run build

before_deploy:
- mkdir -p ~/.ssh
- echo $DEPLOY_KEY > ~/.ssh/id_ed25519
- git remote set-url origin ${GIT_URL}
- git fetch origin gh-pages:remotes/origin/gh-pages
- git worktree add -B gh-pages dist origin/gh-pages
- git checkout gh-pages
- git add dist
- git commit -m 'Update gh-pages'

deploy:
  skip_cleanup: true
  provider: script
  script: git push -f
# on:
#   branch: master
